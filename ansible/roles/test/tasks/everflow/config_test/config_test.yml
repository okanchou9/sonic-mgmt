- name: Define variables for test
  set_fact:
    testname: config_test

- block:
    - name: Config tests - invalid SRC IP address.
      vars:
        session_name: "config_src_ip_invalid_1"
        option: "create"
        src_ip: "11111.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid DST IP address.
      vars:
        session_name: "config_dst_ip_invalid_1"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2222.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid GRE type (non integer value).
      vars:
        session_name: "config_gre_type_invalid_1"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x65z58"
        dscp: "50"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid GRE type (value < that min bound).
      vars:
        session_name: "config_gre_type_invalid_2"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "-- -1"
        dscp: "50"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid GRE type (value > that min bound).
      vars:
        session_name: "config_gre_type_invalid_3"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0xffffff"
        dscp: "50"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid DSCP (non integer value).
      vars:
        session_name: "config_dscp_invalid_1"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "5x0"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid DSCP (value < that min bound).
      vars:
        session_name: "config_dscp_invalid_2"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "-- -1"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid DSCP (value > that min bound).
      vars:
        session_name: "config_dscp_invalid_3"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "100"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid TTL (non integer value).
      vars:
        session_name: "config_ttl_invalid_1"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "-- -1is"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid TTL (value < that min bound).
      vars:
        session_name: "config_ttl_invalid_2"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "-- -1"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid TTL (value > that min bound).
      vars:
        session_name: "config_ttl_invalid_3"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "100000"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid queue (non integer value).
      vars:
        session_name: "config_queue_invalid_1"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "10"
        queue: "5o4"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid queue (value < that min bound).
      vars:
        session_name: "config_queue_invalid_2"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "10"
        queue: "-- -1"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - invalid queue (value > that max bound).
      vars:
        session_name: "config_queue_invalid_3"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "50"
        ttl: "10"
        queue: "1000"
        test_expect_file: config_test_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - valid config (all integers are in 10 base).
      vars:
        session_name: "config_valid_1"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "25944"
        dscp: "50"
        ttl: "10"
        queue: "5"
        test_expect_file: config_test_expect_file
        errors_expected: false
        run_cleanup: false
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - valid config (all integers are in hex).
      vars:
        session_name: "config_valid_1"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "0x32"
        ttl: "0xa"
        queue: "0x5"
        test_expect_file: config_test_update_expect_file
        errors_expected: true
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - delete configuration part 1 (apply config).
      vars:
        session_name: "config_valid_2"
        option: "create"
        src_ip: "1.1.1.1"
        dst_ip: "2.2.2.2"
        gre_type: "0x6558"
        dscp: "0x32"
        ttl: "0xa"
        queue: "0x5"
        test_expect_file: config_test_expect_file
        errors_expected: false
        run_cleanup: false
      include: roles/test/tasks/run_configdb_test.yml

    - name: Config tests - delete configuration part 2 (delete config).
      vars:
        session_name: "config_valid_2"
        option: "delete"
        test_expect_file: config_test_expect_file
        errors_expected: false
        run_cleanup: true
      include: roles/test/tasks/run_configdb_test.yml

  always:
    - name: Run command to remove config_valid_1
      command: "python /home/admin/everflow_tests/mirror_session.py delete config_valid_1"

    - name: Run command to remove config_valid_2
      command: "python /home/admin/everflow_tests/mirror_session.py delete config_valid_2"